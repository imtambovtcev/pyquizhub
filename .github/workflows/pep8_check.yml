name: PEP8 Format Check

on:
  pull_request:
    paths:
      - '**.py'

jobs:
  check-formatting:
    runs-on: ubuntu-latest
    steps:
    - name: Check out code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: 3.x

    - name: Install autopep8
      run: pip install autopep8

    - name: Check code formatting
      run: |
        FILES=$(find . -name "*.py")
        echo "Files being checked:"
        echo "$FILES"
        echo "-----------------------------"
        FORMAT_ISSUES=0
        for file in $FILES; do
            DIFF=$(autopep8 --diff $file)
            if [[ ! -z "$DIFF" ]]; then
                echo "⚠️ Formatting issue detected in: $file"
                echo "$DIFF"
                echo "-----------------------------"
                FORMAT_ISSUES=1
            fi
        done
        if [[ $FORMAT_ISSUES -eq 1 ]]; then
            echo "ℹ️ Code formatting issues detected. These will be auto-fixed when merged to main."
            exit 0  # Don't fail the check
        else
            echo "✅ All code is properly formatted!"
        fi